#!/usr/bin/env ruby
require 'optparse'
require 'stackprof-webnav'

options = {
  :port => 9292
}

parser = OptionParser.new(ARGV) do |o|
  o.banner = "Usage: stackprof-webnav file.dump|http://path/to/file.dump [-p NUMBER]"
  o.on('-p [PORT]', 'Server port') {|port| options[:port] = port }
end

parser.parse!
parser.abort(parser.help) if ARGV.empty?

file = ARGV.pop
server = StackProf::Webnav::Server

if File.exists?(file)
  server.report_dump_path = File.expand_path(file)
else
  server.report_dump_url = file
end

server.run! options[:port]
